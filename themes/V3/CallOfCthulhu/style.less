@import (less) './themes/assets/assets.less';
@import (less) './themes/fonts/5e/fonts.less';
@import (less) './themes/fonts/CallOfCthulhu/fonts.less';

//Colors
@background              : rgba(255, 255, 255, 0.3); // Lighter parchment
@noteGreen               : #e2dcdf; // Light purple
@headerUnderline         : #8d8187; // Gray purple
@horizontalRule          : #9c2b1b; // Maroon
@headerText              : #010613; // Dark maroon
@subHeaderText           : #3c4464; // Purple
@characterStatBackground : #EEDBAB; // Light orange parchment
@captionText             : #766649; // Brown
@watercolorStain         : #BBAD82; // Light brown

@page { margin: 0; }
body {
  counter-reset : phb-page-numbers;
}
*{
  -webkit-print-color-adjust : exact;
}
.useSansSerif(){
  font-family : ScalySansRemake;
  font-size   : 0.318cm;
  line-height : 1.2em;
  p,dl,ul,ol {
    line-height : 1.2em;
  }
  ul, ol {
    padding-left : 1em;
  }
  em{
    font-style  : italic;
  }
  strong{
    font-weight    : 800;
    letter-spacing : -0.02em;
  }
  h5 + * {
    margin-top : 0.1cm;
  }
}
.useColumns(@multiplier : 1, @fillMode: balance){
  column-count         : 2;
  column-fill          : @fillMode;
  column-gap           : 0.9cm;
  column-width         : 8cm * @multiplier;
  -webkit-column-count : 2;
  -moz-column-count    : 2;
  -webkit-column-width : 8cm * @multiplier;
  -moz-column-width    : 8cm * @multiplier;
  -webkit-column-gap   : 0.9cm;
  -moz-column-gap      : 0.9cm;
}
.columnWrapper{
  max-height        : 100%;
  column-span       : all;
  columns           : inherit;
  column-gap        : inherit;
}
.page{
  .useColumns();
  counter-increment : phb-page-numbers;
  position          : relative;
  z-index           : 15;
  box-sizing        : border-box;
  overflow          : hidden;
  height            : 279.4mm;
  width             : 215.9mm;
  background-color  : @background;
  /* TODO: Create another backgroun image */
  background-image  : @lightBackgroundImage;
  padding           : 1.4cm 1.9cm 1.7cm;
  font-family       : BookInsanityRemake;
  font-size         : 0.34cm;
  text-rendering    : optimizeLegibility;
  page-break-before : always;
  page-break-after  : always;

  //*****************************
  // *            BASE
  // *****************************/
  p{
    overflow-wrap : break-word;		//TODO: MAKE ALL MARGINS TOP-ONLY. USE * + * STYLE SELECTORS
    display       : block;
    line-height   : 1.25em;
    &+* {
      margin-top : 0.325cm;
    }
    &+p{
      margin-top : 0;
    }
  }

  /* Add arrow shaped marker */
  ul {
    margin-bottom       : 0.8em;
    padding-left        : 1.4em;
    line-height         : 1.25em;
    list-style: none outside none;
  }

  ul li::before {
    content: "";
    border-color: transparent #111;
    border-style: solid;
    border-width: 0.35em 0 0.35em 0.45em;
    display: block;
    height: 0;
    width: 0;
    left: -1em;
    top: 0.9em;
    position: relative;
  }

  ol{
    margin-bottom       : 0.8em;
    padding-left        : 1.4em;
    line-height         : 1.25em;
    list-style-position : outside;
    list-style-type     : decimal;
  }
  //Indents after p or lists
  p+p, ul+p, ol+p{
    text-indent : 1em;
  }

  img{
    z-index : -1;
  }
  strong{
    font-weight    : bold;
    letter-spacing : -0.02em;
  }
  em{
    font-style : italic;
  }
  sup{
    vertical-align : super;
    font-size      : smaller;
    line-height    : 0;
  }
  sub{
    vertical-align : sub;
    font-size      : smaller;
    line-height    : 0;
  }

  a{
    color           : inherit;
    text-decoration : underline;
    &:hover{
      color: red;
    }
  }

  //*****************************
  // *           HEADERS
  // *****************************/
  h1, h2, h3, h4{
    font-family   : Prata;
    font-weight   : 800;
    text-align: center;
  }
  h1, h2 {
    color         : @headerText;
  }
  h3, h4, h5, h6 {
    color         : @subHeaderText;
  }
  h1{
    margin-bottom       : .22cm; //Margin-bottom only because this is WIDE
    column-span         : all;
    font-size           : .89cm;
    -webkit-column-span : all;
    -moz-column-span    : all;

    // This doesn't really look that good. If a better font could be found, the first letter style would be nice
    /*
    &+p::first-letter{
      float                   : left;
      // TODO: Add a different fist letter font that doesn't get behind the other characters
      // in the paragraph
      font-family             : Sacramento;
      line-height             : 1em;
      font-size               : 3.5cm;
      padding-left            : 40px; //Allow background color to extend into margins
      margin-left             : -40px;
      margin-top              : -0.3cm;
      padding-bottom          : 2px;
      margin-bottom           : 0;
      /* The following should be added again when a different font is applied
      background: rgb(13,20,49);
      background: linear-gradient(125deg, rgba(13,20,49,1) 0%, rgba(13,20,49,1) 76%, rgba(13,20,49,0.2) 100%);
      background-clip         : text;
      -webkit-background-clip : text;
      color                   : rgba(0, 0, 0, 0);
    }
    &+p::first-line{
      font-variant : small-caps;
    }
    */
  }
  h2{
    font-size     : 0.75cm;
    margin-bottom: .2cm;
  }
  p + h2 {
    margin-top: .8em
  }
  h3{
    font-size     : 0.575cm;
    margin-bottom: .16cm;
  }
  p + h3 {
    margin-top: .8em;
  }
  h4{
    font-size     : 0.458cm;
    margin-bottom: .12cm;
  }
  h5{
    font-family   : ScalySansSmallCapsRemake;
    font-size     : 0.423cm;
    font-weight   : 900;
    line-height   : 0.951em; //Font is misaligned. Shift up slightly
    & + * {
      margin-top : 0.2cm;
    }
  }
  //*****************************
  // *          TABLE
  // *****************************/
  table{
    .useSansSerif();
    width         : 100%;
    & + * {
      margin-top : 0.325cm;
    }
    thead{
      display: table-row-group;
      font-weight : 800;
      th{
        vertical-align : bottom;
        padding        : 0.14em 0.4em;
      }
    }
    tbody{
      tr{
        td{
          padding : 0.14em 0.4em;
        }
        &:nth-child(odd){
          background-color : @noteGreen;
        }
      }
    }
  }
  //*****************************
  // *            NOTE
  // *****************************/
  .note{
    margin: 0 0 2em 0;
    background-color: @background;
    border-style        : solid;
    border-color        : transparent;
    border-width        : 4px;
    /* TODO: Make a nicer frame, add wide note style */
    border-image        : @CoCFramePurple 25 fill;
    border-image-outset : 14px 0px;
    border-image-width  : 1.5em;
    padding             : 0.13cm 0.16cm;

    h1, h2, h3, h4, h5 {
      text-align: center;
    }

  }
  //************************************
  // *       DESCRIPTIVE TEXT BOX
  // ************************************/
  .descriptive{
    font-family: Inconsolata, serif;
    padding: 1em 1.2em;
    margin: .5em 0 3em 0;
    /* TODO: Add nicer frame */
    border-left: solid thin @headerUnderline;
    border-right: solid thin @headerUnderline;
    background-color: @background;

    h1, h2, h3, h4, h5 {
      text-align: center;
    }
  }

  //*****************************
  // *    Images Snippets
  // *****************************/

  /* Arist Credit */
  .artist {
    position    : absolute;
    width       : auto;
    text-align  : center;
    font-family : WalterTurncoat;
    font-size   : 0.27cm;
    color       : @captionText;
    p, p + p {
      margin      : unset;
      text-indent : unset;
      line-height : 1em;
    }
    h5 {
      font-size   : 1.3em;
      font-family : WalterTurncoat;
    }
    a{
      color           : inherit;
      text-decoration : unset;
      &:hover {
        text-decoration : underline;
      }
    }
  }

  /* Watermark */
  .watermark {
    display         : grid !important;
    place-items     : center;
    justify-content	: center;
    position        : absolute;
    top             : 0;
    left            : 0;
    width           : 100%;
    height          : 100%;
    font-size       : 120px;
    text-transform	: uppercase;
    color           : black;
    mix-blend-mode  : overlay;
    opacity         : 30%;
    transform       : rotate(-45deg);
    z-index         : 500;
    p {
      margin-bottom : 0;
    }
  }

  /* Watercolor */
  [class*="watercolor"] {
    position            : absolute;
    width               : 2000px;    /* dimensions need to be real big so the user can set */
    height              : 2000px;    /* height or width and the image will maintain aspect ratio */
    -webkit-mask-image  : var(--wc);
    -webkit-mask-size   : contain;
    -webkit-mask-repeat : no-repeat;
    mask-image          : var(--wc);
    mask-size           : contain;
    mask-repeat         : no-repeat;
    background-size     : cover;
    background-color    : @watercolorStain;			/*default color*/
    --wc                : @watercolor1;         /*default image*/
    z-index             : -2;
  }

  .watercolor1  { --wc : @watercolor1; }
  .watercolor2  { --wc : @watercolor2; }
  .watercolor3  { --wc : @watercolor3; }
  .watercolor4  { --wc : @watercolor4; }
  .watercolor5  { --wc : @watercolor5; }
  .watercolor6  { --wc : @watercolor6; }
  .watercolor7  { --wc : @watercolor7; }
  .watercolor8  { --wc : @watercolor8; }
  .watercolor9  { --wc : @watercolor9; }
  .watercolor10 { --wc : @watercolor10; }
  .watercolor11 { --wc : @watercolor11; }
  .watercolor12 { --wc : @watercolor12; }

  //*****************************
  // *           FOOTER
  // *****************************/
  &:after{
    content          : "";
    position         : absolute;
    bottom           : 0px;
    left             : 0px;
    z-index          : 100;
    height           : 50px;
    width            : 100%;
    background-size  : cover;
  }
  .pageNumber{
    position    : absolute;
    right       : calc(50% - 16px);
    bottom      : 22px;
    width       : 32px;
    height      : 32px;
    padding-top : 8px;
    font-size   : 16px;

    border: thin solid @subHeaderText;
    border-radius: 50%;

    color       : @subHeaderText;
    text-align  : center;
    text-indent : 0;

    &.auto::after {
      content : counter(phb-page-numbers);
    }
  }
  .footnote{
    position   : absolute;
    right      : 80px;
    bottom     : 32px;
    z-index    : 150;
    width      : 200px;
    font-size  : 0.8em;
    color      : @subHeaderText;
    text-align : right;
  }
  //************************************
  // *           CODE BLOCKS
  // ************************************/
  code{
    font-family      : "Courier New", Courier, monospace;
    font-size        : 0.325;
    padding          : 0px 4px;
    color            : #58180d;
    background-color : #faf7ea;
    border-radius    : 4px;
    white-space      : pre-wrap;
    overflow-wrap    : break-word;
  }

  pre code{
    width               : 100%;
    display             : inline-block;
    border-style        : solid;
    border-width        : 1px;
    border-image        : @codeBorderImage 26 stretch;
    border-image-width  : 10px;
    border-image-outset : 2px;
    border-radius       : 12px;
    margin-bottom       : 2px;
    padding             : 0.15cm;
    .page :where(&) {
      margin-top        : 2px; //Prevent top border getting cut off on colbreak
    }
    & + * {
      margin-top : 0.325cm;
    }
  }
  //*****************************
  // *          EXTRAS
  // *****************************/
  hr{
    visibility : hidden;
    margin     : 0px;
  }
  .columnSplit {
    visibility                 : hidden;
    -webkit-column-break-after : always;
    break-after                : always;
    -moz-column-break-after    : always;
    break-before               : column;
  }
  //Avoid breaking up
  blockquote,table{
    z-index                     : 15;
    -webkit-column-break-inside : avoid;
    page-break-inside           : avoid;
    break-inside                : avoid;
  }
  //Text indent right after table
  table+p{
    text-indent : 1em;
  }
  // Nested lists
  ul ul,ol ol,ul ol,ol ul{
    margin-bottom : 0px;
    margin-left   : 1.5em;
  }
  li{
    -webkit-column-break-inside : avoid;
    page-break-inside           : avoid;
    break-inside                : avoid;
  }
}

//*****************************
// *      TABLE OF CONTENTS
// *****************************/
.page .toc{
  -webkit-column-break-inside : avoid;
  page-break-inside           : avoid;
  break-inside                : avoid;

  background-color: @background;
  border-style        : solid;
  border-width        : 4px;
  border-color        : transparent;
  /* TODO: Make a nicer frame, change to wide frame */
  border-image        : @CoCFrameBlack 25 fill;
  border-image-outset : 14px 0px;
  border-image-width  : 1.5em;

  padding: 2em 1em;

  h1 {
    margin-bottom: .6em;
  }

  h3, h4, h5, h6, span {
    text-align: left;
  }

  h4, h5, h6, span {
    font-family: SpecialElite;
  }

  h3 {
    font-size: 0.45cm;
    margin-top: 1cm;
    margin-bottom : 0.3cm;
    border-bottom: solid thin @subHeaderText;

    span {
      font-family   : Prata !important;
      padding-top: 2px;
    }
  }

  h4 {
    font-size: 0.4cm;
    margin-bottom: .12cm;

    span {
      padding-top: 2px;
    }
  }

  h5 {
    font-size: 0.3cm;
    margin-bottom: .08cm;
  }

  h4, h5, h6 {
    color: @headerText !important;
  }

  h4 {
    margin-top  : 0.2cm;
    line-height : 0.4cm;
    & + ul li {
      line-height: 1.2em;
    }
  }

  ul{
    padding-left    : 1em;
    list-style-type : none;
    li::before {
      display: none;
    }
    li + li h3 {
      margin-top  : 0.26cm;
      line-height : 1em
    }
    h3 span:first-child::after {
      border : none;
    }
    span {
      display : table-cell;
      &:first-child {
        position   :       relative;
        overflow   :       hidden;
        &::after {
          content       : "";
          position      : absolute;
          bottom        : 0.08cm;
          margin-left   : 0.06cm;        /* Spacing before dot leaders */
          width         : 100%;
          border-bottom : 0.05cm dotted #000;
        }
      }
      &:last-child {
        font-size      : 0.34cm;
        font-weight    : normal;
        color          : black;
        text-align     : right;
        vertical-align : bottom; /* Keep page number bottom-aligned */
        width          : 1%;
        padding-left   : 0.06cm; /* Spacing after dot leaders */
        /*white-space  : nowrap; /* Uncomment if needed */
      }
    }
    ul { /*List indent*/
      margin-left : 1em;
    }
  }
  &.wide{
    .useColumns(0.96, @fillMode: balance);
  }
}

//*****************************
// *    MUSTACHE DIVS/SPANS
// *****************************/
.page {
  .block {
    break-inside      : avoid;
    display           : inline-block;
    .page :where(&) {
      width             : 100%;
    }
    //-webkit-transform : translateZ(0); //Prevents shadows from breaking across columns
  }
  .inline-block {
    display : inline-block;
    text-indent : initial;
  }
}

//*****************************
// *    DEFINITION LISTS
// *****************************/
.page {
  dl {
    line-height  : 1.25em;
    padding-left : 1em;
    white-space  : pre-line;
    & + * {
      margin-top : 0.28cm;
    }
  }
  dl + * {
    margin-top : 0.17cm;
  }
  p + dl {
    margin-top: 0.17cm;
  }
  dt {
    display      : inline;
    margin-right : 5px;
    margin-left  : -1em;
  }
  dd {
    display     : inline;
    margin-left : 0px;
    text-indent : 0px;
  }
}

//*****************************
// *    BLANK LINE
// *****************************/
.page {
  .blank {
    height     : 1em;
    margin-top : 0;
  }
}

//*****************************
// *         WIDE
// *****************************/
.page .wide{
  column-span         : all;
  -webkit-column-span : all;
  -moz-column-span    : all;
  display             : block;
  margin-bottom       : 0.34cm;
  &+* {
    margin-top : 0;
  }
}

//*****************************
// *  Character/Monster block
// *****************************/

.cocCharacter {
  margin-bottom: 1.5em;
}

.cocStatsBlock {
  text-align: center;
  margin: 1em 0 3em 0;
  background-color: @background;
  border-style: solid;
  border-width: 4px;
  border-color: transparent;
  /* TODO: Make a nicer frame */
  border-image: @CoCFrameBlack 25 fill;
  border-image-outset: 14px 0px;
  border-image-width: 1.5em;
  padding: 0.13cm 0.16cm;

  h1, h2, h3, h4, h5, h6 {
    border-bottom: none;
    font-family: NotoSerifDisplay;
  }

  h1 {
    font-size: .7cm;
    margin-bottom: .22cm;
  }

  h2 {
    font-size: 0.55cm;
    margin-bottom: .2cm;
  }

  h3 {
    font-size: 0.45cm;
    margin-bottom: .16cm;
  }

  h4 {
    font-size: 0.4cm;
    margin-bottom: .12cm;
  }

  h5 {
    font-size: 0.3cm;
    margin-bottom: .08cm;
  }

  table tbody tr:nth-child(odd) {
    background-color: @noteGreen;
  }

  table tbody tr td:nth-child(even) {
    padding: .07em;
  }
}

.cocCharacter p strong:not(:first-child){
  margin-left: .6em;
}

p+.cocCharacter p,
ul+.cocCharacter p,
ol+.cocCharacter p{
  text-indent : 0;
}

.cocCharacter p+ul {
  margin-top: 0;
}

.cocCharacter p {
  padding-left: 1em !important;
  text-indent: -1em !important;
}

// *****************************
// *       Title Quote
// *****************************/

.titleQuote {
  border-top: solid thin @headerUnderline;
  padding-top: 0.6em;
  margin-bottom: 1.2em;

  p {
    font-family: SpecialElite;
    margin: 0 10% .6em;

    text-indent: 0 !important;
  }

  h6 {
    font-family: SpecialElite;
    color: black;
    margin: 0 10% .6em;
    text-align: right;
  }
  h6:before {
    content: "-";
  }
}

.titleQuote.wide {
  margin-bottom: 3.2em;
}

// *****************************
// *       Letter
// *****************************/

.page .letter {
  background-image: @backgroundImage;
  padding: 2em;

  border: thin solid rgba(255, 255, 255, .1);
  border-radius: 5px;
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);

  margin-bottom: 2em;

  h1, h2, h3, h4, h5, h6, p {
    font-family: Tangerine;
    color: #0d1431;
  }
  h1 {
    font-size: 1.2cm;
    margin-bottom: .22cm;
  }

  h2 {
    font-size: 1cm;
    margin-bottom: .2cm;
  }

  h3 {
    font-size: .85cm;
    margin-bottom: .16cm;
  }

  h4 {
    font-size: .7cm;
    margin-bottom: .12cm;
  }

  h5 {
    font-size: .55cm;
    margin-bottom: .08cm;
  }
  p {
    padding-left: 0 !important;
    text-indent: 0 !important;
    font-size: .55cm;
    margin-bottom: .02cm;
  }
  h6 {
    font-size: .55cm;
    margin: 0 10% .6em;
    text-align: right;
  }
}

// *****************************
// *           Bok
// *****************************/

.page .book {
  background-image: @backgroundImage;
  padding: 2em;

  border: solid rgba(255, 255, 255, .1);
  border-radius: 5px;
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);

  margin-bottom: 2em;

  h1, h2, h3, h4, h5, h6, p {
    font-family: SpecialElite;
    color: black;
  }

  h6 {
    margin: .6em 0;
    text-align: right;
  }

  h6:before {
    content: "-";
  }
}